<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.edugame.server.controller.ServerViewController"
            stylesheets="@../css/server-style.css"
            styleClass="root-pane">

    <!-- Top: Header Bar -->
    <top>
        <HBox styleClass="header-bar" spacing="15">
            <padding>
                <Insets top="20" right="25" bottom="20" left="25"/>
            </padding>

            <VBox spacing="5" HBox.hgrow="ALWAYS">
                <Label text="ðŸŽ® MATH ADVENTURE SERVER" styleClass="header-title"/>
                <Label fx:id="serverStatusLabel" text="â— Server Running" styleClass="status-label"/>
            </VBox>

            <VBox alignment="CENTER_RIGHT" spacing="8">
                <HBox spacing="15" alignment="CENTER_RIGHT">
                    <VBox alignment="CENTER" spacing="3" styleClass="stat-box">
                        <Label text="CONNECTIONS" styleClass="stat-label"/>
                        <Label fx:id="connectionsLabel" text="0" styleClass="stat-value"/>
                    </VBox>

                    <VBox alignment="CENTER" spacing="3" styleClass="stat-box">
                        <Label text="ROOMS" styleClass="stat-label"/>
                        <Label fx:id="roomsLabel" text="0" styleClass="stat-value"/>
                    </VBox>

                    <VBox alignment="CENTER" spacing="3" styleClass="stat-box">
                        <Label text="PLAYERS" styleClass="stat-label"/>
                        <Label fx:id="playersLabel" text="0" styleClass="stat-value"/>
                    </VBox>
                </HBox>

                <HBox spacing="10">
                    <Button fx:id="startButton" text="â–¶ Start" styleClass="btn-success" onAction="#handleStart"/>
                    <Button fx:id="stopButton" text="â¸ Stop" styleClass="btn-danger" onAction="#handleStop" disable="true"/>
                    <Button fx:id="questionBankButton" text="ðŸ“ Questions" styleClass="btn-primary" onAction="#handleOpenQuestionBank"/>
                </HBox>
            </VBox>
        </HBox>
    </top>

    <!-- Center: Tab Content -->
    <center>
        <TabPane fx:id="mainTabPane" styleClass="main-tabs" tabClosingPolicy="UNAVAILABLE">

            <!-- Tab 1: Room Management -->
            <Tab text="ðŸ“¦ Room Management">
                <SplitPane dividerPositions="0.3" styleClass="split-pane">

                    <!-- Left: Room List -->
                    <VBox styleClass="room-list-container" spacing="10">
                        <padding>
                            <Insets top="15" right="15" bottom="15" left="15"/>
                        </padding>

                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="ACTIVE ROOMS" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ”„" styleClass="btn-icon" onAction="#handleRefreshRooms"/>
                        </HBox>

                        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="room-scroll">
                            <VBox fx:id="roomListContainer" spacing="8"/>
                        </ScrollPane>
                    </VBox>

                    <!-- Right: Room Details -->
                    <VBox styleClass="room-detail-container" spacing="15">
                        <padding>
                            <Insets top="15" right="15" bottom="15" left="15"/>
                        </padding>

                        <!-- Room Header -->
                        <HBox alignment="CENTER_LEFT" spacing="15" styleClass="detail-header">
                            <Label fx:id="selectedRoomTitle" text="Select a room" styleClass="detail-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="roomStatusBadge" text="WAITING" styleClass="status-badge"/>
                            <Button fx:id="closeRoomButton" text="âœ–" styleClass="btn-close" onAction="#handleCloseRoom" visible="false"/>
                        </HBox>

                        <Separator/>

                        <!-- Room Info -->
                        <GridPane fx:id="roomInfoGrid" hgap="15" vgap="10" styleClass="info-grid" visible="false">
                            <Label text="Room ID:" GridPane.columnIndex="0" GridPane.rowIndex="0" styleClass="info-label"/>
                            <Label fx:id="roomIdLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0" styleClass="info-value"/>

                            <Label text="Host:" GridPane.columnIndex="0" GridPane.rowIndex="1" styleClass="info-label"/>
                            <Label fx:id="hostLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1" styleClass="info-value"/>

                            <Label text="Subject:" GridPane.columnIndex="0" GridPane.rowIndex="2" styleClass="info-label"/>
                            <Label fx:id="subjectLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2" styleClass="info-value"/>

                            <Label text="Difficulty:" GridPane.columnIndex="0" GridPane.rowIndex="3" styleClass="info-label"/>
                            <Label fx:id="difficultyLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="3" styleClass="info-value"/>
                        </GridPane>

                        <!-- Players Section -->
                        <VBox spacing="10" fx:id="playersSection" visible="false">
                            <Label text="PLAYERS" styleClass="section-subtitle"/>
                            <ScrollPane fitToWidth="true" prefHeight="200" styleClass="player-scroll">
                                <VBox fx:id="playerListContainer" spacing="8"/>
                            </ScrollPane>
                        </VBox>

                        <!-- Admin Actions -->
                        <VBox spacing="10" fx:id="adminActionsSection" visible="false">
                            <Label text="ADMIN ACTIONS" styleClass="section-subtitle"/>
                            <HBox spacing="10">
                                <Button fx:id="pauseButton" text="â¸ Pause Game" styleClass="btn-warning" onAction="#handlePauseGame" prefWidth="130"/>
                                <Button fx:id="resumeButton" text="â–¶ Resume" styleClass="btn-success" onAction="#handleResumeGame" visible="false" prefWidth="130"/>
                                <Button fx:id="announceButton" text="ðŸ“¢ Announce" styleClass="btn-primary" onAction="#handleAnnounce" prefWidth="130"/>
                            </HBox>
                            <Button fx:id="destroyButton" text="ðŸ’£ Destroy Room" styleClass="btn-danger-solid" onAction="#handleDestroyRoom" prefWidth="270"/>
                        </VBox>

                        <!-- Empty State -->
                        <VBox fx:id="emptyState" alignment="CENTER" spacing="15" VBox.vgrow="ALWAYS">
                            <Label text="ðŸ“¦" style="-fx-font-size: 48px;"/>
                            <Label text="No room selected" styleClass="empty-text"/>
                            <Label text="Click on a room from the list to view details" styleClass="empty-subtext"/>
                        </VBox>
                    </VBox>
                </SplitPane>
            </Tab>

            <!-- Tab 2: User Management -->
            <Tab text="ðŸ‘¥ User Management">
                <BorderPane styleClass="user-management-container">

                    <!-- Top Toolbar -->
                    <top>
                        <VBox spacing="15">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>

                            <!-- Title and Stats -->
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="USER MANAGEMENT" styleClass="section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label fx:id="totalUsersLabel" text="Total: 0 users" styleClass="info-value"/>
                            </HBox>

                            <!-- Search and Actions -->
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <TextField fx:id="userSearchField" promptText="ðŸ” Search by username or email..."
                                           prefWidth="300" styleClass="search-field"/>
                                <Button text="Search" styleClass="btn-primary" onAction="#handleSearchUsers"/>
                                <Button text="ðŸ”„ Refresh" styleClass="btn-secondary" onAction="#handleRefreshUsers"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="âž• Add User" styleClass="btn-success" onAction="#handleAddUser"/>
                            </HBox>

                            <!-- Filters -->
                            <HBox spacing="15" alignment="CENTER_LEFT" styleClass="filter-bar">
                                <Label text="Filter:" styleClass="filter-label"/>
                                <ComboBox fx:id="userStatusFilter" promptText="All Status" prefWidth="120"/>
                                <ComboBox fx:id="userSortFilter" promptText="Sort By" prefWidth="150"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label fx:id="filteredCountLabel" text="Showing: 0 users" styleClass="filter-label"/>
                            </HBox>
                        </VBox>
                    </top>

                    <!-- Center: User Table -->
                    <center>
                        <TableView fx:id="userTable" styleClass="data-table">
                            <padding>
                                <Insets top="0" right="15" bottom="15" left="15"/>
                            </padding>
                        </TableView>
                    </center>
                </BorderPane>
            </Tab>

            <!-- Tab 3: Server Console -->
            <Tab text="ðŸ–¥ï¸ Console">
                <VBox spacing="10" styleClass="console-container">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="SERVER LOG" styleClass="section-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ—‘ï¸ Clear" styleClass="btn-secondary" onAction="#handleClearLog"/>
                    </HBox>

                    <TextArea fx:id="consoleArea" editable="false" wrapText="true"
                              VBox.vgrow="ALWAYS" styleClass="console-text"/>
                </VBox>
            </Tab>

            <!-- Tab 4: Statistics -->
            <Tab text="ðŸ“Š Statistics">
                <ScrollPane fitToWidth="true" styleClass="stats-scroll">
                    <VBox spacing="20" styleClass="stats-container">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>

                        <Label text="SERVER STATISTICS" styleClass="section-title"/>

                        <GridPane hgap="20" vgap="20" styleClass="stats-grid">
                            <!-- Row 1 -->
                            <VBox styleClass="stat-card" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                <Label text="Total Connections" styleClass="stat-card-title"/>
                                <Label fx:id="totalConnectionsLabel" text="0" styleClass="stat-card-value"/>
                                <Label text="Since server start" styleClass="stat-card-subtitle"/>
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <Label text="Total Games" styleClass="stat-card-title"/>
                                <Label fx:id="totalGamesLabel" text="0" styleClass="stat-card-value"/>
                                <Label text="Completed matches" styleClass="stat-card-subtitle"/>
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="2" GridPane.rowIndex="0">
                                <Label text="Peak Players" styleClass="stat-card-title"/>
                                <Label fx:id="peakPlayersLabel" text="0" styleClass="stat-card-value"/>
                                <Label text="Maximum concurrent" styleClass="stat-card-subtitle"/>
                            </VBox>

                            <!-- Row 2 -->
                            <VBox styleClass="stat-card" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                <Label text="Uptime" styleClass="stat-card-title"/>
                                <Label fx:id="uptimeLabel" text="00:00:00" styleClass="stat-card-value"/>
                                <Label text="Server running time" styleClass="stat-card-subtitle"/>
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                <Label text="Messages Sent" styleClass="stat-card-title"/>
                                <Label fx:id="messagesSentLabel" text="0" styleClass="stat-card-value"/>
                                <Label text="Total packets" styleClass="stat-card-subtitle"/>
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="2" GridPane.rowIndex="1">
                                <Label text="Average Response" styleClass="stat-card-title"/>
                                <Label fx:id="avgResponseLabel" text="0ms" styleClass="stat-card-value"/>
                                <Label text="Server latency" styleClass="stat-card-subtitle"/>
                            </VBox>
                        </GridPane>
                    </VBox>
                </ScrollPane>
            </Tab>

        </TabPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox styleClass="status-bar" spacing="20" alignment="CENTER_LEFT">
            <padding>
                <Insets top="10" right="20" bottom="10" left="20"/>
            </padding>

            <Label fx:id="portLabel" text="Port: 8888"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="uptimeStatusLabel" text="Uptime: 00:00:00"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="memoryLabel" text="Memory: 0 MB"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="timestampLabel" text="Last update: --:--:--" styleClass="timestamp-label"/>
        </HBox>
    </bottom>

</BorderPane>