<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<BorderPane styleClass="root-pane" stylesheets="@../css/server-style.css" xmlns="http://javafx.com/javafx/25" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.edugame.server.controller.ServerViewController">

    <!-- Top: Header Bar -->
    <top>
        <HBox spacing="15" styleClass="header-bar">
            <padding>
                <Insets bottom="10" left="25" right="25" top="10" />
            </padding>

            <VBox spacing="5" HBox.hgrow="ALWAYS">
                <Label styleClass="header-title" text="EDUGAMESERVER" />
                <Label fx:id="serverStatusLabel" styleClass="status-label" text="â— Server Running" />
            </VBox>

            <VBox alignment="CENTER_RIGHT" spacing="8">
                <HBox alignment="CENTER_RIGHT" spacing="15">
                    <VBox alignment="CENTER" spacing="3" styleClass="stat-box">
                        <Label styleClass="stat-label" text="CONNECTIONS" />
                        <Label fx:id="connectionsLabel" styleClass="stat-value" text="0" />
                    </VBox>

                    <VBox alignment="CENTER" spacing="3" styleClass="stat-box">
                        <Label styleClass="stat-label" text="ROOMS" />
                        <Label fx:id="roomsLabel" styleClass="stat-value" text="0" />
                    </VBox>

                    <VBox alignment="CENTER" spacing="3" styleClass="stat-box">
                        <Label styleClass="stat-label" text="PLAYERS" />
                        <Label fx:id="playersLabel" styleClass="stat-value" text="0" />
                    </VBox>
                </HBox>

                <HBox spacing="10">
                    <Button fx:id="startButton" onAction="#handleStart" styleClass="btn-success" text="â–¶ Start" />
                    <Button fx:id="stopButton" disable="true" onAction="#handleStop" styleClass="btn-danger" text="â¸ Stop" />
                    <Button fx:id="questionBankButton" onAction="#handleOpenQuestionBank" styleClass="btn-primary" text="ðŸ“ Questions" />
                </HBox>
            </VBox>
        </HBox>
    </top>

    <!-- Center: Tab Content -->
    <center>
        <TabPane fx:id="mainTabPane" styleClass="main-tabs" tabClosingPolicy="UNAVAILABLE">

            <!-- Tab 1: Room Management -->
            <Tab text="ðŸ“¦ Quáº£n lÃ½ phÃ²ng">
                <BorderPane styleClass="room-management-container">

                    <!-- Left: Room List -->
                    <left>
                        <VBox prefWidth="310" spacing="12" styleClass="room-list-panel">
                            <padding>
                                <Insets bottom="10" left="10" right="15" top="10" />
                            </padding>

                            <!-- Header -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label styleClass="panel-title" text="Danh sÃ¡ch phÃ²ng" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Label styleClass="info-text" text="Tá»•ng sá»‘ phÃ²ng: " />
                                <Label fx:id="totalRoomsLabel" styleClass="info-value-accent" text="0" />
                            </HBox>

                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <Label styleClass="info-text-sm" text="Äang chÆ¡i: " />
                                <Label fx:id="playingRoomsLabel" styleClass="status-playing" text="0" />
                                <Region prefWidth="10" />
                                <Label styleClass="info-text-sm" text="Chá»: " />
                                <Label fx:id="waitingRoomsLabel" styleClass="status-waiting" text="0" />
                            </HBox>

                            <Separator />

                            <!-- Refresh Button -->
                            <Button maxWidth="Infinity" onAction="#handleRefreshRooms" styleClass="btn-refresh-rooms" text="ðŸ”„ LÃ m má»›i" />

                            <!-- Room List ScrollPane -->
                            <ScrollPane fitToWidth="true" styleClass="room-list-scroll" VBox.vgrow="ALWAYS">
                                <VBox fx:id="roomListContainer" spacing="10" styleClass="room-cards-container" />
                            </ScrollPane>
                        </VBox>
                    </left>

                    <!-- Right: Room Details & Progress -->
                    <center>
                        <VBox spacing="10" styleClass="room-detail-panel">
                            <padding>
                                <Insets bottom="10" left="10" right="10" top="10" />
                            </padding>

                            <!-- Room Header -->
                            <HBox alignment="CENTER_LEFT" spacing="15" styleClass="room-header">
                                <VBox spacing="5" HBox.hgrow="ALWAYS">
                                    <Label fx:id="selectedRoomTitle" styleClass="room-title" text="Chá»n má»™t phÃ²ng Ä‘á»ƒ xem chi tiáº¿t" />
                                    <HBox alignment="CENTER_LEFT" spacing="10">
                                        <Label fx:id="roomStatusBadge" styleClass="status-badge status-waiting" text="WAITING" />

                                        <Label fx:id="roomIdLabel" styleClass="room-id-text" text="#" />
                                    </HBox>
                                </VBox>
                                <Button fx:id="closeRoomButton" onAction="#handleCloseRoom" styleClass="btn-close-detail" text="âœ–" visible="false" />
                            </HBox>

                            <Separator />

                            <!-- Empty State -->
                            <VBox fx:id="emptyState" alignment="CENTER" spacing="10" VBox.vgrow="ALWAYS">
                                <Region VBox.vgrow="ALWAYS" />
                                <Label style="-fx-font-size: 64px; -fx-opacity: 0.5;" text="ðŸ“¦" />
                                <VBox alignment="CENTER" spacing="8">
                                    <Label styleClass="empty-title" text="ChÆ°a chá»n phÃ²ng nÃ o" />
                                    <Label styleClass="empty-subtitle" text="Nháº¥p vÃ o phÃ²ng á»Ÿ danh sÃ¡ch bÃªn trÃ¡i Ä‘á»ƒ xem chi tiáº¿t" />
                                </VBox>
                                <Region VBox.vgrow="ALWAYS" />
                            </VBox>

                            <!-- Room Content (Hidden by default) -->
                            <VBox fx:id="roomContent" spacing="10" visible="false" VBox.vgrow="ALWAYS">

                                <!-- Room Info Grid -->
                                <GridPane fx:id="roomInfoGrid" hgap="10" styleClass="room-info-grid" vgap="12">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="50" />
                                        <ColumnConstraints percentWidth="50" />
                                    </columnConstraints>

                                    <!-- Row 1 -->
                                    <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                        <Label styleClass="info-label" text="Host" />
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label style="-fx-font-size: 16px;" text="ðŸ‘¤" />
                                            <Label fx:id="hostLabel" styleClass="info-value" text="MathKing99" />
                                        </HBox>
                                    </VBox>

                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                        <Label styleClass="info-label" text="MÃ´n há»c" />
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label fx:id="subjectIconLabel" style="-fx-font-size: 16px;" text="ðŸ”¢" />
                                            <Label fx:id="subjectLabel" styleClass="info-value" text="ToÃ¡n" />
                                        </HBox>
                                    </VBox>

                                    <!-- Row 2 -->
                                    <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                        <Label styleClass="info-label" text="Äá»™ khÃ³" />
                                        <Label fx:id="difficultyLabel" styleClass="difficulty-badge" text="Trung bÃ¬nh" />
                                    </VBox>

                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                        <Label styleClass="info-label" text="Sá»‘ ngÆ°á»i chÆ¡i" />
                                        <HBox alignment="CENTER_LEFT" spacing="8">
                                            <Label style="-fx-font-size: 16px;" text="ðŸ‘¥" />
                                            <Label fx:id="playerCountLabel" styleClass="info-value" text="3/4" />
                                        </HBox>
                                    </VBox>
                           <rowConstraints>
                              <RowConstraints />
                              <RowConstraints />
                           </rowConstraints>
                                </GridPane>

                                <Separator />

                                <!-- Progress Section -->
                                <VBox spacing="15" styleClass="progress-section">
                                    <HBox alignment="CENTER_LEFT" spacing="10">
                                        <Label styleClass="section-title" text="ðŸ“Š Tiáº¿n Ä‘á»™ tráº­n Ä‘áº¥u" />
                                        <Region HBox.hgrow="ALWAYS" />
                                        <Label fx:id="currentQuestionLabel" styleClass="progress-text" text="CÃ¢u 5/10" />
                                    </HBox>

                                    <!-- Progress Bar -->
                                    <VBox spacing="8">
                                        <ProgressBar fx:id="gameProgressBar" maxWidth="Infinity" prefHeight="12" progress="0.5" styleClass="game-progress-bar" />
                                        <HBox alignment="CENTER_LEFT" spacing="15">
                                            <Label style="-fx-font-size: 14px;" text="â±ï¸" />
                                            <Label fx:id="timeRemainingLabel" styleClass="time-text" text="30s cÃ²n láº¡i" />
                                        </HBox>
                                    </VBox>

                                    <!-- Game Stats -->
                                    <GridPane hgap="15" styleClass="stats-grid" vgap="10">
                                        <columnConstraints>
                                            <ColumnConstraints percentWidth="33.33" />
                                            <ColumnConstraints percentWidth="33.33" />
                                            <ColumnConstraints percentWidth="33.33" />
                                        </columnConstraints>

                                        <VBox alignment="CENTER" spacing="5" styleClass="stat-card" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                            <Label style="-fx-font-size: 10px;" text="ðŸŽ¯" />
                                            <Label fx:id="correctAnswersLabel" styleClass="stat-value" text="12" />
                                            <Label styleClass="stat-label" text="ÄÃºng" />
                                        </VBox>

                                        <VBox alignment="CENTER" spacing="5" styleClass="stat-card" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                            <Label style="-fx-font-size: 10px;" text="âŒ" />
                                            <Label fx:id="wrongAnswersLabel" styleClass="stat-value" text="3" />
                                            <Label styleClass="stat-label" text="Sai" />
                                        </VBox>

                                        <VBox alignment="CENTER" spacing="5" styleClass="stat-card" GridPane.columnIndex="2" GridPane.rowIndex="0">
                                            <Label style="-fx-font-size: 10px;" text="â­ï¸" />
                                            <Label fx:id="skippedLabel" styleClass="stat-value" text="1" />
                                            <Label styleClass="stat-label" text="Bá» qua" />
                                        </VBox>
                              <rowConstraints>
                                 <RowConstraints />
                              </rowConstraints>
                                    </GridPane>
                                </VBox>

                                <Separator />

                                <!-- Players in Room -->
                                <VBox fx:id="playersSection" spacing="12">
                                    <Label styleClass="section-title" text="ðŸ‘¥ NgÆ°á»i chÆ¡i trong phÃ²ng" />
                                    <ScrollPane fitToWidth="true" prefHeight="100" styleClass="players-scroll">
                                        <VBox fx:id="playerListContainer" spacing="8" />
                                    </ScrollPane>
                                </VBox>

                                <Separator />

                                <!-- Admin Actions -->
                                <VBox fx:id="adminActionsSection" spacing="12">
                                    <Label styleClass="section-title" text="âš™ï¸ HÃ nh Ä‘á»™ng quáº£n trá»‹" />

                                    <GridPane hgap="10" vgap="10">
                                        <columnConstraints>
                                            <ColumnConstraints percentWidth="50" />
                                            <ColumnConstraints percentWidth="50" />
                                        </columnConstraints>

                                        <Button fx:id="pauseButton" maxWidth="Infinity" onAction="#handlePauseGame" styleClass="btn-warning" text="â¸ï¸ Táº¡m dá»«ng" GridPane.columnIndex="0" GridPane.rowIndex="0" />

                                        <Button fx:id="resumeButton" maxWidth="Infinity" onAction="#handleResumeGame" styleClass="btn-success" text="â–¶ï¸ Tiáº¿p tá»¥c" visible="false" GridPane.columnIndex="0" GridPane.rowIndex="0" />

                                        <Button fx:id="announceButton" maxWidth="Infinity" onAction="#handleAnnounce" styleClass="btn-primary" text="ðŸ“¢ ThÃ´ng bÃ¡o" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                        <Button fx:id="kickPlayerButton" maxWidth="Infinity" onAction="#handleKickPlayer" styleClass="btn-warning-outline" text="ðŸ‘Š Kick ngÆ°á»i chÆ¡i" GridPane.columnIndex="0" GridPane.rowIndex="1" />

                                        <Button fx:id="destroyButton" maxWidth="Infinity" onAction="#handleDestroyRoom" styleClass="btn-danger" text="ðŸ’£ Há»§y phÃ²ng" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                              <rowConstraints>
                                 <RowConstraints />
                                 <RowConstraints />
                              </rowConstraints>
                                    </GridPane>
                                </VBox>
                            </VBox>
                        </VBox>
                    </center>

                </BorderPane>
            </Tab>

            <!-- Tab 2: User Management -->
            <Tab text="ðŸ‘¥ Quáº£n lÃ½ ngÆ°á»i dÃ¹ng">
                <BorderPane styleClass="user-management-container">

                    <!-- Top Toolbar -->
                    <top>
                        <VBox spacing="15">
                            <padding>
                                <Insets bottom="15" left="15" right="15" top="15" />
                            </padding>

                            <!-- Title and Stats -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label styleClass="section-title" text="QUáº¢N LÃ NGÆ¯á»œI DÃ™NG" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Label fx:id="totalUsersLabel" styleClass="info-value" text="Total: 0 users" />
                            </HBox>

                            <!-- Search and Actions -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <TextField fx:id="userSearchField" prefWidth="300" promptText="ðŸ” Search by username or email..." styleClass="search-field" />
                                <Button onAction="#handleSearchUsers" styleClass="btn-primary" text="Search" />
                                <Button onAction="#handleRefreshUsers" styleClass="btn-secondary" text="ðŸ”„ Refresh" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Button onAction="#handleAddUser" styleClass="btn-success" text="âž• Add User" />
                            </HBox>

                            <!-- Filters -->
                            <HBox alignment="CENTER_LEFT" spacing="15" styleClass="filter-bar">
                                <Label styleClass="filter-label" text="Filter:" />
                                <ComboBox fx:id="userStatusFilter" onAction="#handleFilterUsers" prefWidth="110" promptText="All Status" />
                                <ComboBox fx:id="userSortFilter" onAction="#handleFilterUsers" prefWidth="150" promptText="Sort By" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Label fx:id="filteredCountLabel" styleClass="filter-label" text="Showing: 0 users" />
                            </HBox>
                        </VBox>
                    </top>

                    <!-- Center: User Table -->
                    <center>
                        <TableView fx:id="userTable" styleClass="data-table">
                            <padding>
                                <Insets bottom="15" left="15" right="15" top="0" />
                            </padding>
                        </TableView>
                    </center>
                </BorderPane>
            </Tab>

            <!-- Tab 3: Server Console -->
            <Tab text="ðŸ–¥ï¸ Báº£ng Ä‘iá»u khiá»ƒn">
                <VBox spacing="10" styleClass="console-container">
                    <padding>
                        <Insets bottom="15" left="15" right="15" top="15" />
                    </padding>

                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="section-title" text="SERVER LOG" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button onAction="#handleClearLog" styleClass="btn-secondary" text="ðŸ—‘ï¸ Clear" />
                    </HBox>

                    <TextArea fx:id="consoleArea" editable="false" styleClass="console-text" wrapText="true" VBox.vgrow="ALWAYS" />
                </VBox>
            </Tab>

            <!-- Tab 4: Statistics -->
            <Tab text="ðŸ“Š Thá»‘ng kÃª">
                <ScrollPane fitToWidth="true" styleClass="stats-scroll">
                    <VBox spacing="10" styleClass="stats-container">
                        <padding>
                            <Insets bottom="10" left="10" right="10" top="10" />
                        </padding>

                        <Label styleClass="section-title" text="THá»NG KÃŠ MÃY CHá»¦" />

                        <GridPane hgap="10" styleClass="stats-grid" vgap="10">
                            <!-- Row 1 -->
                            <VBox styleClass="stat-card" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                <Label styleClass="stat-card-title" text="Tá»•ng sá»‘ káº¿t ná»‘i" />
                                <Label fx:id="totalConnectionsLabel" styleClass="stat-card-value" text="0" />
                                <Label styleClass="stat-card-subtitle" text="Since server start" />
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <Label styleClass="stat-card-title" text="Tá»•ng sá»‘ trÃ² chÆ¡i" />
                                <Label fx:id="totalGamesLabel" styleClass="stat-card-value" text="0" />
                                <Label styleClass="stat-card-subtitle" text="Completed matches" />
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="2" GridPane.rowIndex="0">
                                <Label styleClass="stat-card-title" text="NgÆ°á»i chÆ¡i Ä‘á»‰nh cao" />
                                <Label fx:id="peakPlayersLabel" styleClass="stat-card-value" text="0" />
                                <Label styleClass="stat-card-subtitle" text="Maximum concurrent" />
                            </VBox>

                            <!-- Row 2 -->
                            <VBox styleClass="stat-card" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                <Label styleClass="stat-card-title" text="Thá»i gian hoáº¡t Ä‘á»™ng" />
                                <Label fx:id="uptimeLabel" styleClass="stat-card-value" text="00:00:00" />
                                <Label styleClass="stat-card-subtitle" text="Server running time" />
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                <Label styleClass="stat-card-title" text="Tin nháº¯n Ä‘Ã£ gá»­i" />
                                <Label fx:id="messagesSentLabel" styleClass="stat-card-value" text="0" />
                                <Label styleClass="stat-card-subtitle" text="Total packets" />
                            </VBox>

                            <VBox styleClass="stat-card" GridPane.columnIndex="2" GridPane.rowIndex="1">
                                <Label styleClass="stat-card-title" text="Pháº£n há»“i trung bÃ¬nh" />
                                <Label fx:id="avgResponseLabel" styleClass="stat-card-value" text="0ms" />
                                <Label styleClass="stat-card-subtitle" text="Server latency" />
                            </VBox>
                     <columnConstraints>
                        <ColumnConstraints />
                        <ColumnConstraints />
                        <ColumnConstraints />
                     </columnConstraints>
                     <rowConstraints>
                        <RowConstraints />
                        <RowConstraints />
                     </rowConstraints>
                        </GridPane>
                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- Tab 5: Server Messages - OPTIMIZED UI -->
            <Tab text="ðŸ’¬ Tin nháº¯n mÃ¡y chá»§">
                <BorderPane styleClass="chat-container">

                    <!-- LEFT PANEL: USER RECIPIENT LIST -->
                    <left>
                        <VBox prefWidth="380" spacing="12" styleClass="client-list-panel" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets bottom="10" left="10" right="15" top="10" />
                            </padding>

                            <!-- Header -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label styleClass="panel-title" text="ðŸ“‹ Chá»n ngÆ°á»i nháº­n" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Button onAction="#handleRefreshRecipients"
                                        styleClass="btn-icon"
                                        style="-fx-padding: 4 8; -fx-font-size: 12px;"
                                        text="ðŸ”„" />
                            </HBox>

                            <Separator />

                            <!-- Quick Filter -->
                            <HBox spacing="10">
                                <TextField fx:id="recipientSearchField"
                                           promptText="ðŸ” Search users..."
                                           styleClass="search-field"
                                           HBox.hgrow="ALWAYS" />

                                <ComboBox fx:id="recipientStatusFilter"
                                          onAction="#handleFilterRecipients"
                                          prefWidth="100"
                                          promptText="All Status">
                                    <items>
                                        <FXCollections fx:factory="observableArrayList">
                                            <String fx:value="All" />
                                            <String fx:value="Online" />
                                            <String fx:value="Offline" />
                                        </FXCollections>
                                    </items>
                                </ComboBox>
                            </HBox>

                            <!-- Table -->
                            <TableView fx:id="recipientTable"
                                       styleClass="data-table"
                                       VBox.vgrow="ALWAYS">
                                <placeholder>
                                    <Label styleClass="empty-subtitle" text="No users available" />
                                </placeholder>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                </columnResizePolicy>
                            </TableView>

                            <!-- Selection Info -->
                            <HBox alignment="CENTER_LEFT" spacing="10" styleClass="selection-info">
                                <Label styleClass="info-label" text="ðŸ“Š Selected:" />
                                <Label fx:id="selectedUsersCountLabel" styleClass="info-value-accent" text="0 users" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Button onAction="#handleClearSelection"
                                        styleClass="btn-secondary-sm"
                                        style="-fx-padding: 4 10; -fx-font-size: 12px;"
                                        text="Clear" />
                            </HBox>
                        </VBox>
                    </left>

                    <!-- RIGHT PANEL: MESSAGE COMPOSER -->
                    <center>
                        <VBox spacing="14" styleClass="message-composer-panel" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets bottom="10" left="10" right="10" top="10" />
                            </padding>

                            <!-- Header -->
                            <VBox spacing="6">
                                <Label styleClass="section-title" text="âœ‰ï¸ Soáº¡n tin nháº¯n mÃ¡y chá»§" />
                                <Label styleClass="section-subtitle"
                                       text="Gá»­i thÃ´ng bÃ¡o hoáº·c tin nháº¯n riÃªng tÆ° cho ngÆ°á»i dÃ¹ng" />
                            </VBox>

                            <Separator />

                            <!-- Message Type Buttons -->
                            <VBox spacing="10">
                                <Label styleClass="info-label" text="Loáº¡i tin nháº¯n:" />

                                <HBox spacing="10">
                                    <Button fx:id="sendBroadcastButton"
                                            onAction="#handleSendBroadcast"
                                            styleClass="btn-broadcast"
                                            style="-fx-padding: 6 12; -fx-font-size: 12px;"
                                            text="Táº¥t cáº£ ngÆ°á»i dÃ¹ng"
                                            HBox.hgrow="ALWAYS" />

                                    <Button fx:id="sendGroupButton"
                                            onAction="#handleSendGroup"
                                            styleClass="btn-group"
                                            style="-fx-padding: 6 12; -fx-font-size: 12px;"
                                            text="NgÆ°á»i Ä‘Æ°á»£c chá»n"
                                            HBox.hgrow="ALWAYS" />

                                    <Button fx:id="sendPrivateButton"
                                            onAction="#handleSendPrivate"
                                            styleClass="btn-private"
                                            style="-fx-padding: 6 12; -fx-font-size: 12px;"
                                            text="Gá»­i riÃªng"
                                            HBox.hgrow="ALWAYS" />
                                </HBox>
                            </VBox>

                            <!-- MESSAGE INPUT -->
                            <VBox spacing="10" VBox.vgrow="ALWAYS">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label styleClass="info-label" text="Ná»™i dung tin nháº¯n" />
                                    <Region HBox.hgrow="ALWAYS" />
                                    <CheckBox fx:id="importantCheckBox"
                                              styleClass="important-checkbox"
                                              text="*ÄÃ¡nh dáº¥u quan trá»ng" />
                                </HBox>

                                <TextArea fx:id="serverMessageInput"
                                          promptText="Nháº­p tin nháº¯n táº¡i Ä‘Ã¢y..."
                                          styleClass="message-textarea"
                                          wrapText="true"
                                          prefHeight="220"
                                          maxHeight="Infinity"
                                          VBox.vgrow="ALWAYS" />

                                <!-- Char counter -->
                                <HBox alignment="CENTER_LEFT" spacing="15">
                                    <HBox spacing="5" alignment="CENTER_LEFT">
                                        <Label style="-fx-font-size: 12px;" text="ðŸ“" />
                                        <Label fx:id="charCountLabel"
                                               styleClass="char-count-label"
                                               text="0 / 500 characters" />
                                    </HBox>

                                    <Region HBox.hgrow="ALWAYS" />

                                    <Button onAction="#handleClearMessageInput"
                                            styleClass="btn-secondary"
                                            style="-fx-padding: 6 12; -fx-font-size: 12px;"
                                            text="LÃ m má»›i" />
                                </HBox>
                            </VBox>

                            <Separator />

                            <!-- QUICK TEMPLATES -->
                            <VBox spacing="10">
                                <Label styleClass="info-label" text="ðŸ“‹ Quick Templates:" />

                                <HBox spacing="8">
                                    <Button onAction="#handleTemplateWelcome"
                                            styleClass="btn-template-sm"
                                            style="-fx-padding: 4 10; -fx-font-size: 11px;"
                                            text="ðŸŽ‰ Welcome" />

                                    <Button onAction="#handleTemplateMaintenance"
                                            styleClass="btn-template-sm"
                                            style="-fx-padding: 4 10; -fx-font-size: 11px;"
                                            text="âš ï¸ Maintenance" />

                                    <Button onAction="#handleTemplateEvent"
                                            styleClass="btn-template-sm"
                                            style="-fx-padding: 4 10; -fx-font-size: 11px;"
                                            text="ðŸŽ® Event" />

                                    <Button onAction="#handleTemplateAnnouncement"
                                            styleClass="btn-template-sm"
                                            style="-fx-padding: 4 10; -fx-font-size: 11px;"
                                            text="ðŸ“¢ Announcement" />
                                </HBox>
                            </VBox>

                            <Separator />

                            <!-- HISTORY -->
                            <VBox spacing="10" VBox.vgrow="ALWAYS">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label styleClass="info-label" text="ðŸ“œ Recent Messages" />

                                    <Region HBox.hgrow="ALWAYS" />

                                    <Button onAction="#handleRefreshMessageHistory"
                                            styleClass="btn-icon-sm"
                                            style="-fx-padding: 4 8; -fx-font-size: 12px;"
                                            text="ðŸ”„" />

                                    <Button onAction="#handleViewFullHistory"
                                            styleClass="btn-secondary-sm"
                                            style="-fx-padding: 4 10; -fx-font-size: 12px;"
                                            text="ðŸ“– View Full History" />
                                </HBox>

                                <ScrollPane fitToWidth="true"
                                            prefHeight="260"
                                            maxHeight="320"
                                            styleClass="message-history-scroll"
                                            VBox.vgrow="ALWAYS">
                                    <VBox fx:id="messageHistoryContainer"
                                          spacing="8"
                                          styleClass="message-history-container">
                                    </VBox>
                                </ScrollPane>
                            </VBox>

                        </VBox>
                    </center>

                </BorderPane>
            </Tab>


        </TabPane>
    </center>

    <!-- Bottom: Status Bar (FIXED) -->
    <bottom>
        <HBox alignment="CENTER_LEFT" spacing="10" styleClass="status-bar">
            <padding>
                <Insets bottom="10" left="10" right="10" top="10" />
            </padding>

            <!-- IP Label (NEW) -->
            <Label fx:id="ipLabel" styleClass="status-info" text="IP: Loading..." />
            <Separator orientation="VERTICAL" />

            <Label fx:id="portLabel" styleClass="status-info" text="Port: --" />
            <Separator orientation="VERTICAL" />

            <Label fx:id="uptimeStatusLabel" styleClass="status-info" text="Uptime: 00:00:00" />
            <Separator orientation="VERTICAL" />

            <Label fx:id="memoryLabel" styleClass="status-info" text="Memory: 0 MB" />

            <Region HBox.hgrow="ALWAYS" />

            <!-- Copy Connection Info Button (NEW) -->
            <Button onAction="#handleCopyConnectionInfo" styleClass="btn-secondary-sm" text="ðŸ“‹ Copy IP:Port">
                <tooltip>
                    <Tooltip text="Copy connection info to clipboard" />
                </tooltip>
            </Button>

            <Label fx:id="timestampLabel" styleClass="timestamp-label" text="Last update: --:--:--" />
        </HBox>
    </bottom>

</BorderPane>
