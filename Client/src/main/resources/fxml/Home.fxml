<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.edugame.client.controller.HomeController"
            styleClass="home-root"
            prefWidth="1000" prefHeight="700"
>

    <!-- HEADER -->
    <top>
        <HBox alignment="CENTER_LEFT" styleClass="main-header">
            <padding>
                <Insets top="15" bottom="15" left="20" right="20"/>
            </padding>

            <!-- LEFT: Avatar + User Info -->
            <HBox spacing="12" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                <!-- Avatar -->
                <StackPane styleClass="user-avatar">
                    <ImageView fx:id="userAvatar" fitHeight="50" fitWidth="50" preserveRatio="true"  onMouseClicked="#handleAvatarClick">
                        <image>
                            <Image url="@../images/avatars/avatar4.png"/>
                        </image>
                    </ImageView>
                </StackPane>

                <!-- User Info -->
                <VBox spacing="3">
                    <Text fx:id="userNameText" text="Nguyễn Văn An" styleClass="user-name"/>
                    <HBox spacing="15">
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Text text="🏆" styleClass="info-icon"/>
                            <Text fx:id="pointsText" text="2,450 điểm" styleClass="info-text"/>
                        </HBox>
                    </HBox>
                </VBox>
            </HBox>

            <!-- RIGHT: Settings + Logout -->
            <HBox spacing="12" alignment="CENTER_RIGHT">
                <Button fx:id="settingsButton" text="⚙" styleClass="header-button"
                        onAction="#handleSettings"/>
                <Button fx:id="friendsButton" text="👥" styleClass="header-button"
                        onAction="#handleFriends"/>
                <Button fx:id="logoutButton" text="🚪" styleClass="header-button logout-button"
                        onAction="#handleLogout"/>
            </HBox>
        </HBox>
    </top>

    <!-- MAIN CONTENT -->
    <center>
        <VBox spacing="20" styleClass="main-content">
            <padding>
                <Insets top="20" bottom="20" left="20" right="20"/>
            </padding>

            <!-- ROW 1: 3 Game Mode Cards -->
            <HBox spacing="20" alignment="CENTER">
                <!-- Card 1: Luyện Tập -->
                <VBox spacing="15" styleClass="game-card" HBox.hgrow="ALWAYS">
                    <StackPane styleClass="card-icon training-icon">
                        <Text text="🎯" styleClass="icon-large"/>
                    </StackPane>

                    <VBox spacing="8" alignment="CENTER">
                        <Text text="Luyện Tập" styleClass="card-title"/>
                        <Text text="Chơi một mình để rèn luyện" styleClass="card-desc" textAlignment="CENTER" wrappingWidth="200"/>

                        <HBox spacing="10" alignment="CENTER" styleClass="card-info">
                            <Text text="👤 1 người" styleClass="card-meta"/>
                            <Text text="⏱️ 10 phút" styleClass="card-meta"/>
                        </HBox>
                    </VBox>

                    <Button text="Chơi ngay" styleClass="card-button"
                            onAction="#handleTrainingMode" maxWidth="Infinity"/>
                </VBox>

                <!-- Card 2: Đấu Nhanh -->
                <VBox spacing="15" styleClass="game-card" HBox.hgrow="ALWAYS">
                    <StackPane styleClass="card-icon quick-icon">
                        <Text text="⚡" styleClass="icon-large"/>
                    </StackPane>

                    <VBox spacing="8" alignment="CENTER">
                        <Text text="Đấu Nhanh" styleClass="card-title"/>
                        <Text text="Tìm đối thủ và thi đấu 1vs1" styleClass="card-desc" textAlignment="CENTER" wrappingWidth="200"/>

                        <HBox spacing="10" alignment="CENTER" styleClass="card-info">
                            <Text text="👥 2 người" styleClass="card-meta"/>
                            <Text text="🏆 Cộng điểm" styleClass="card-meta"/>
                        </HBox>
                    </VBox>

                    <Button text="Tìm đối thủ" styleClass="card-button"
                            onAction="#handleQuickMatch" maxWidth="Infinity"/>
                </VBox>

                <!-- Card 3: Tạo Phòng -->
                <VBox spacing="15" styleClass="game-card" HBox.hgrow="ALWAYS">
                    <StackPane styleClass="card-icon room-icon">
                        <Text text="🏠" styleClass="icon-large"/>
                    </StackPane>

                    <VBox spacing="8" alignment="CENTER">
                        <Text text="Tạo Phòng" styleClass="card-title"/>
                        <Text text="Chơi cùng bạn bè của bạn" styleClass="card-desc" textAlignment="CENTER" wrappingWidth="200"/>

                        <HBox spacing="10" alignment="CENTER" styleClass="card-info">
                            <Text text="👥 2-4 người" styleClass="card-meta"/>
                            <Text text="💬 Có chat" styleClass="card-meta"/>
                        </HBox>
                    </VBox>

                    <Button text="Tạo phòng" styleClass="card-button"
                            onAction="#handleCreateRoom" maxWidth="Infinity"/>
                </VBox>
            </HBox>

            <!-- ROW 2: Leaderboard + Chat -->
            <HBox spacing="20" VBox.vgrow="ALWAYS">
                <!-- Leaderboard Box -->
                <VBox spacing="12" styleClass="leaderboard-box" prefWidth="350">
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="box-header">
                        <Text text="🏆" styleClass="box-header-icon"/>
                        <Text text="Bảng Xếp Hạng" styleClass="box-header-title"/>
                    </HBox>

                    <!-- Dynamic leaderboard content -->
                    <VBox spacing="8" fx:id="leaderboardList" styleClass="leaderboard-content">
                        <!-- Nội dung sẽ được tạo động từ HomeController -->
                    </VBox>

                    <!-- View All Button -->
                    <HBox alignment="CENTER">
                        <Button text="Xem thêm" styleClass="view-more-btn" onAction="#handleViewLeaderboard"/>
                    </HBox>
                </VBox>

                <!-- Chat Box -->
                <VBox spacing="0" styleClass="chat-box" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="box-header chat-header">
                        <StackPane styleClass="chat-header">
                            <Text text="💬 Chat Toàn Cầu" styleClass="box-header-icon"/>
                        </StackPane>

                        <Text text="" styleClass="box-header-title"/>
                    </HBox>

                    <!-- Chat Messages -->
                    <ScrollPane fx:id="chatScrollPane" styleClass="chat-scroll"
                                fitToWidth="true" hbarPolicy="NEVER" VBox.vgrow="ALWAYS">
                        <VBox fx:id="chatMessagesContainer" spacing="10" styleClass="chat-messages">
                            <padding>
                                <Insets top="12" bottom="12" left="12" right="12"/>
                            </padding>

                            <!-- Sample Message 1 -->
                            <VBox spacing="3" styleClass="chat-message">
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Text text="Thám Tử Tư Duy" styleClass="chat-sender"/>
                                    <Text text="●" styleClass="chat-online"/>
                                </HBox>
                                <Text text="Giải mã bí ẩn tri thức nào!" styleClass="chat-text"/>
                            </VBox>

                            <!-- Sample Message 2 -->
                            <VBox spacing="3" styleClass="chat-message">
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Text text="Phép Thuật Gia Toán" styleClass="chat-sender"/>
                                    <Text text="●" styleClass="chat-online"/>
                                </HBox>
                                <Text text="Sẵn sàng biến hóa những con số chưa?" styleClass="chat-text"/>
                            </VBox>

                            <!-- Sample Message 3 - Self -->
                            <VBox spacing="3" styleClass="chat-message chat-self">
                                <Text text="Nhà Khoa Học Tí Hon" styleClass="chat-sender-self"/>
                                <Text text="Ai muốn bay vào không gian học tập?" styleClass="chat-text-self"/>
                            </VBox>
                        </VBox>
                    </ScrollPane>

                    <!-- Chat Input -->
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <!-- Emoji Button -->
                        <Button fx:id="emojiButton"
                                text="😊"
                                onAction="#handleShowEmoji"
                                styleClass="emoji-button"/>

                        <!-- Text Input -->
                        <TextField fx:id="chatInputField"
                                   promptText="Nhập tin nhắn..."
                                   HBox.hgrow="ALWAYS"/>

                        <!-- Send Button -->
                        <Button fx:id="sendChatButton"
                                text="Gửi"
                                onAction="#handleSendMessage"
                                styleClass="send-button"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>
    </center>
</BorderPane>