<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.edugame.client.controller.HomeController"
            styleClass="home-root"
            prefWidth="1000" prefHeight="700">

    <!-- HEADER -->
    <top>
        <HBox alignment="CENTER_LEFT" styleClass="main-header">
            <padding>
                <Insets top="15" bottom="15" left="20" right="20"/>
            </padding>

            <!-- LEFT: Avatar + User Info -->
            <HBox spacing="12" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                <!-- Avatar -->
                <StackPane styleClass="user-avatar">
                    <ImageView fx:id="userAvatar" fitHeight="50" fitWidth="50" preserveRatio="true">
                        <image>
                            <Image url="@../images/avatars/avatar4.png"/>
                        </image>
                    </ImageView>
                </StackPane>

                <!-- User Info -->
                <VBox spacing="3">
                    <Text fx:id="userNameText" text="Nguyá»…n VÄƒn An" styleClass="user-name"/>
                    <HBox spacing="15">
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Text text="â­" styleClass="info-icon"/>
                            <Text fx:id="levelText" text="Level 12" styleClass="info-text"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Text text="ðŸ†" styleClass="info-icon"/>
                            <Text fx:id="pointsText" text="2,450 Ä‘iá»ƒm" styleClass="info-text"/>
                        </HBox>
                    </HBox>
                </VBox>
            </HBox>

            <!-- RIGHT: Settings + Logout -->
            <HBox spacing="12" alignment="CENTER_RIGHT">
                <Button fx:id="settingsButton" text="âš™CÃ i Ä‘áº·t" styleClass="header-button"
                        onAction="#handleSettings"/>
                <Button fx:id="logoutButton" text="ðŸšª ÄÄƒng xuáº¥t" styleClass="header-button logout-button"
                        onAction="#handleLogout"/>
            </HBox>
        </HBox>
    </top>

    <!-- MAIN CONTENT -->
    <center>
        <VBox spacing="20" styleClass="main-content">
            <padding>
                <Insets top="20" bottom="20" left="20" right="20"/>
            </padding>

            <!-- ROW 1: 3 Game Mode Cards -->
            <HBox spacing="20" alignment="CENTER">
                <!-- Card 1: Luyá»‡n Táº­p -->
                <VBox spacing="15" styleClass="game-card" HBox.hgrow="ALWAYS">
                    <StackPane styleClass="card-icon training-icon">
                        <Text text="ðŸŽ¯" styleClass="icon-large"/>
                    </StackPane>

                    <VBox spacing="8" alignment="CENTER">
                        <Text text="Luyá»‡n Táº­p" styleClass="card-title"/>
                        <Text text="ChÆ¡i má»™t mÃ¬nh Ä‘á»ƒ rÃ¨n luyá»‡n" styleClass="card-desc" textAlignment="CENTER" wrappingWidth="200"/>

                        <HBox spacing="10" alignment="CENTER" styleClass="card-info">
                            <Text text="ðŸ‘¤ 1 ngÆ°á»i" styleClass="card-meta"/>
                            <Text text="â±ï¸ 10 phÃºt" styleClass="card-meta"/>
                        </HBox>
                    </VBox>

                    <Button text="ChÆ¡i ngay" styleClass="card-button"
                            onAction="#handleTrainingMode" maxWidth="Infinity"/>
                </VBox>

                <!-- Card 2: Äáº¥u Nhanh -->
                <VBox spacing="15" styleClass="game-card" HBox.hgrow="ALWAYS">
                    <StackPane styleClass="card-icon quick-icon">
                        <Text text="âš¡" styleClass="icon-large"/>
                    </StackPane>

                    <VBox spacing="8" alignment="CENTER">
                        <Text text="Äáº¥u Nhanh" styleClass="card-title"/>
                        <Text text="TÃ¬m Ä‘á»‘i thá»§ vÃ  thi Ä‘áº¥u 1vs1" styleClass="card-desc" textAlignment="CENTER" wrappingWidth="200"/>

                        <HBox spacing="10" alignment="CENTER" styleClass="card-info">
                            <Text text="ðŸ‘¥ 2 ngÆ°á»i" styleClass="card-meta"/>
                            <Text text="ðŸ† Cá»™ng Ä‘iá»ƒm" styleClass="card-meta"/>
                        </HBox>
                    </VBox>

                    <Button text="TÃ¬m Ä‘á»‘i thá»§" styleClass="card-button"
                            onAction="#handleQuickMatch" maxWidth="Infinity"/>
                </VBox>

                <!-- Card 3: Táº¡o PhÃ²ng -->
                <VBox spacing="15" styleClass="game-card" HBox.hgrow="ALWAYS">
                    <StackPane styleClass="card-icon room-icon">
                        <Text text="ðŸ " styleClass="icon-large"/>
                    </StackPane>

                    <VBox spacing="8" alignment="CENTER">
                        <Text text="Táº¡o PhÃ²ng" styleClass="card-title"/>
                        <Text text="ChÆ¡i cÃ¹ng báº¡n bÃ¨ cá»§a báº¡n" styleClass="card-desc" textAlignment="CENTER" wrappingWidth="200"/>

                        <HBox spacing="10" alignment="CENTER" styleClass="card-info">
                            <Text text="ðŸ‘¥ 2-4 ngÆ°á»i" styleClass="card-meta"/>
                            <Text text="ðŸ’¬ CÃ³ chat" styleClass="card-meta"/>
                        </HBox>
                    </VBox>

                    <Button text="Táº¡o phÃ²ng" styleClass="card-button"
                            onAction="#handleCreateRoom" maxWidth="Infinity"/>
                </VBox>
            </HBox>

            <!-- ROW 2: Leaderboard + Chat -->
            <HBox spacing="20" VBox.vgrow="ALWAYS">
                <!-- Leaderboard Box -->
                <VBox spacing="12" styleClass="leaderboard-box" prefWidth="350">
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="box-header">
                        <Text text="ðŸ†" styleClass="box-header-icon"/>
                        <Text text="Báº£ng Xáº¿p Háº¡ng" styleClass="box-header-title"/>
                    </HBox>

                    <VBox spacing="8" fx:id="leaderboardList" styleClass="leaderboard-content">
                        <!-- Top 1 -->
                        <HBox spacing="12" alignment="CENTER_LEFT" styleClass="rank-item rank-1">
                            <Text text="1" styleClass="rank-number gold"/>
                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                <Text text="MathKing99" styleClass="rank-name"/>
                                <Text text="3,850 Ä‘iá»ƒm" styleClass="rank-score"/>
                            </VBox>
                            <Text text="â—" styleClass="online-status"/>
                        </HBox>

                        <!-- Top 2 -->
                        <HBox spacing="12" alignment="CENTER_LEFT" styleClass="rank-item rank-2">
                            <Text text="2" styleClass="rank-number silver"/>
                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                <Text text="NumberNinja" styleClass="rank-name"/>
                                <Text text="3,420 Ä‘iá»ƒm" styleClass="rank-score"/>
                            </VBox>
                        </HBox>

                        <!-- Top 3 -->
                        <HBox spacing="12" alignment="CENTER_LEFT" styleClass="rank-item rank-3">
                            <Text text="3" styleClass="rank-number bronze"/>
                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                <Text text="CalcHero" styleClass="rank-name"/>
                                <Text text="3,180 Ä‘iá»ƒm" styleClass="rank-score"/>
                            </VBox>
                            <Text text="â—" styleClass="online-status"/>
                        </HBox>

                        <!-- Current User -->
                        <HBox spacing="12" alignment="CENTER_LEFT" styleClass="rank-item rank-current">
                            <Text text="7" styleClass="rank-number"/>
                            <VBox spacing="2" HBox.hgrow="ALWAYS">
                                <Text text="Báº¡n" styleClass="rank-name"/>
                                <Text text="2,450 Ä‘iá»ƒm" styleClass="rank-score"/>
                            </VBox>
                        </HBox>
                    </VBox>

                    <StackPane>
                        <Button text="Xem thÃªm" styleClass="view-more-btn" onAction="#handleViewLeaderboard"/>
                    </StackPane>
                </VBox>

                <!-- Chat Box -->
                <VBox spacing="0" styleClass="chat-box" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="box-header chat-header">
                        <StackPane styleClass="chat-header">
                            <Text text="ðŸ’¬ Chat tháº¿ giá»›i" styleClass="box-header-icon"/>
                        </StackPane>

                        <Text text="Chat ToÃ n Cáº§u" styleClass="box-header-title"/>
                    </HBox>

                    <!-- Chat Messages -->
                    <ScrollPane fx:id="chatScrollPane" styleClass="chat-scroll"
                                fitToWidth="true" hbarPolicy="NEVER" VBox.vgrow="ALWAYS">
                        <VBox fx:id="chatMessagesContainer" spacing="10" styleClass="chat-messages">
                            <padding>
                                <Insets top="12" bottom="12" left="12" right="12"/>
                            </padding>

                            <!-- Sample Message 1 -->
                            <VBox spacing="3" styleClass="chat-message">
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Text text="ThÃ¡m Tá»­ TÆ° Duy" styleClass="chat-sender"/>
                                    <Text text="â—" styleClass="chat-online"/>
                                </HBox>
                                <Text text="Giáº£i mÃ£ bÃ­ áº©n tri thá»©c nÃ o!" styleClass="chat-text"/>
                            </VBox>

                            <!-- Sample Message 2 -->
                            <VBox spacing="3" styleClass="chat-message">
                                <HBox spacing="6" alignment="CENTER_LEFT">
                                    <Text text="PhÃ©p Thuáº­t Gia ToÃ¡n" styleClass="chat-sender"/>
                                    <Text text="â—" styleClass="chat-online"/>
                                </HBox>
                                <Text text="Sáºµn sÃ ng biáº¿n hÃ³a nhá»¯ng con sá»‘ chÆ°a?" styleClass="chat-text"/>
                            </VBox>

                            <!-- Sample Message 3 - Self -->
                            <VBox spacing="3" styleClass="chat-message chat-self">
                                <Text text="NhÃ  Khoa Há»c TÃ­ Hon" styleClass="chat-sender-self"/>
                                <Text text="Ai muá»‘n bay vÃ o khÃ´ng gian há»c táº­p?" styleClass="chat-text-self"/>
                            </VBox>
                        </VBox>
                    </ScrollPane>

                    <!-- Chat Input -->
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <!-- Emoji Button -->
                        <Button fx:id="emojiButton"
                                text="ðŸ˜Š"
                                onAction="#handleShowEmoji"
                                styleClass="emoji-button"/>

                        <!-- Text Input -->
                        <TextField fx:id="chatInputField"
                                   promptText="Nháº­p tin nháº¯n..."
                                   HBox.hgrow="ALWAYS"/>

                        <!-- Send Button -->
                        <Button fx:id="sendChatButton"
                                text="Gá»­i"
                                onAction="#handleSendMessage"
                                styleClass="send-button"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>
    </center>
</BorderPane>